# Microsoft BASIC M6502 C言語移植版

このプロジェクトは、1976-1978年にMicrosoftが開発したBASIC M6502 Version 1.1のアセンブラコードを現代のC言語に移植したものです。

## 概要

元のMicrosoft BASIC M6502は、Apple II、Commodore PET、Ohio Scientific、MOS Technology KIM-1などの初期のパーソナルコンピューターで動作していた歴史的に重要なBASICインタープリターです。この移植版では、元のアセンブラコードの機能と動作を可能な限り再現しながら、現代のC言語で実装しています。

## 特徴

- **歴史的互換性**: 元のBASIC M6502の動作を忠実に再現
- **現代的実装**: 標準Cライブラリを使用したポータブルなコード
- **メモリ安全性**: 現代的なメモリ管理とエラーハンドリング
- **拡張性**: モジュラー設計による機能拡張の容易性

## 実装済み機能

### 基本コマンド
- `PRINT` - 文字列や数値の出力
- `LET` - 変数への値の代入
- `LIST` - プログラムの一覧表示
- `RUN` - プログラムの実行
- `NEW` - プログラムのクリア

### データ型
- 数値変数（倍精度浮動小数点）
- 文字列変数
- 配列（実装予定）

### 制御構造
- 行番号によるプログラム管理
- 即座実行モード
- エラーハンドリング

## ビルド方法

### 必要な環境
- GCC コンパイラ
- Make
- 標準Cライブラリ（math.hを含む）

### コンパイル
```bash
make
```

### クリーンビルド
```bash
make clean
make
```

## 使用方法

### インタープリターの起動
```bash
./basic
```

### 基本的な使用例

#### 即座実行
```
] PRINT "Hello, World!"
Hello, World!
```

#### プログラムの作成と実行
```
] 10 PRINT "Line 10"
] 20 PRINT "Line 20"
] LIST
10 PRINT "Line 10"
20 PRINT "Line 20"
] RUN
Line 10
Line 20
```

#### 変数の使用
```
] LET A = 42
] PRINT A
42
] LET A$ = "Hello"
] PRINT A$
Hello
```

### 終了
```
] QUIT
```
または
```
] EXIT
```

## プロジェクト構造

```
basic_interpreter/
├── src/
│   ├── main.c          # メインプログラム
│   ├── basic_core.c    # 核心機能
│   └── parser.c        # 構文解析
├── include/
│   └── basic.h         # ヘッダーファイル
├── obj/                # オブジェクトファイル（ビルド時作成）
├── Makefile           # ビルド設定
└── README.md          # このファイル
```

## 技術的詳細

### アーキテクチャ
- **モジュラー設計**: 機能ごとに分離されたモジュール
- **状態管理**: `basic_state_t`構造体による集中的な状態管理
- **メモリ管理**: 動的メモリ割り当てとガベージコレクション
- **エラーハンドリング**: 包括的なエラー検出と報告

### データ構造
- **変数管理**: 連結リストによる動的変数管理
- **プログラム行**: 行番号順にソートされた連結リスト
- **トークン解析**: 構造化されたトークンシステム

### 元のアセンブラコードとの対応

| 元の機能 | C言語実装 |
|---------|----------|
| Page Zero変数 | basic_state_t構造体 |
| JMP/JSR | 関数呼び出し |
| 6502レジスタ | ローカル変数 |
| メモリ管理 | malloc/free |
| 浮動小数点演算 | 標準ライブラリ |

## 制限事項

現在の実装では以下の機能が未実装または制限されています：

- FOR-NEXTループ
- GOSUB-RETURN
- IF-THEN文
- 配列操作（DIM）
- 数学関数（SIN, COS, etc.）
- 文字列関数（LEFT$, RIGHT$, etc.）
- ファイル操作（LOAD, SAVE）

## 今後の拡張予定

1. **制御構造の完全実装**
   - FOR-NEXTループ
   - GOSUB-RETURNサブルーチン
   - IF-THEN条件分岐

2. **数学・文字列関数**
   - 三角関数、対数関数
   - 文字列操作関数

3. **配列サポート**
   - 多次元配列
   - DIMコマンド

4. **ファイル操作**
   - プログラムの保存・読み込み

5. **デバッグ機能**
   - ステップ実行
   - ブレークポイント

## 歴史的背景

このBASICインタープリターは、パーソナルコンピューター革命の基礎となった重要なソフトウェアです：

- **1976-1978年**: Microsoftによって開発
- **多プラットフォーム対応**: 単一のソースコードで複数のコンピューターに対応
- **産業への影響**: ソフトウェアライセンスビジネスモデルの確立
- **教育的価値**: 数百万人のプログラミング入門

## ライセンス

このプロジェクトは教育・研究目的で作成されています。元のMicrosoft BASIC M6502のソースコードはMicrosoftの著作権下にあります。

## 貢献

バグ報告、機能要望、プルリクエストを歓迎します。特に以下の分野での貢献を求めています：

- 未実装機能の追加
- パフォーマンスの最適化
- テストケースの追加
- ドキュメントの改善

## 参考資料

- [Microsoft BASIC-M6502 GitHub Repository](https://github.com/microsoft/BASIC-M6502)
- 元のアセンブラソースコード解析ノート
- 6502プロセッサーアーキテクチャ資料

